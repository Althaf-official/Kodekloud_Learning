### The cluster is broken. We tried deploying an application but it's not working. Troubleshoot and fix the issue.


Start looking at the deployments.

Check the status of all control plane components and identify the component's pod which has an issue.


-------

Run the command: kubectl get pods -n kube-system and check the status of kube-scheduler pod.
We need to check the kube-scheduler manifest file to fix the issue.



The command run by the scheduler pod is incorrect. Here is a snippet of the YAML file.

    spec:
      containers:
      - command:
        - kube-scheduler
        - --authentication-kubeconfig=/etc/kubernetes/scheduler.conf
        - --authorization-kubeconfig=/etc/kubernetes/scheduler.conf
        - --bind-address=127.0.0.1
        - --kubeconfig=/etc/kubernetes/scheduler.conf
        - --leader-elect=true
        ....
Once this is corrected, the scheduler pod will be recreated.


```ruby
controlplane ~ ➜  cat /etc/kubernetes/manifests/
etcd.yaml                     kube-controller-manager.yaml  kube-scheduler.yaml
kube-apiserver.yaml           .kubelet-keep                 

controlplane ~ ➜  cat /etc/kubernetes/manifests/
etcd.yaml                     kube-controller-manager.yaml  kube-scheduler.yaml
kube-apiserver.yaml           .kubelet-keep                 

controlplane ~ ➜  cat /etc/kubernetes/manifests/kube-scheduler.yaml 
apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  labels:
    component: kube-scheduler
    tier: control-plane
  name: kube-scheduler
  namespace: kube-system
spec:
  containers:
  - command:
    - kube-schedulerrrr
    - --authentication-kubeconfig=/etc/kubernetes/scheduler.conf
    - --authorization-kubeconfig=/etc/kubernetes/scheduler.conf
    - --bind-address=127.0.0.1
    - --kubeconfig=/etc/kubernetes/scheduler.conf
    - --leader-elect=true
    image: registry.k8s.io/kube-scheduler:v1.29.0
    imagePullPolicy: IfNotPresent
    livenessProbe:
      failureThreshold: 8
      httpGet:
        host: 127.0.0.1
        path: /healthz
        port: 10259
        scheme: HTTPS
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 15
    name: kube-scheduler
    resources:
      requests:
        cpu: 100m
    startupProbe:
      failureThreshold: 24
      httpGet:
        host: 127.0.0.1
        path: /healthz
        port: 10259
        scheme: HTTPS
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 15
    volumeMounts:
    - mountPath: /etc/kubernetes/scheduler.conf
      name: kubeconfig
      readOnly: true
  hostNetwork: true
  priority: 2000001000
  priorityClassName: system-node-critical
  securityContext:
    seccompProfile:
      type: RuntimeDefault
  volumes:
  - hostPath:
      path: /etc/kubernetes/scheduler.conf
      type: FileOrCreate
    name: kubeconfig
status: {}

controlplane ~ ➜  vi /etc/kubernetes/manifests/kube-scheduler.yaml 

controlplane ~ ➜  k get all
NAME                       READY   STATUS    RESTARTS   AGE
pod/app-5646649cc9-2ktpt   0/1     Pending   0          20m

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   25m

NAME                  READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/app   0/1     1            0           20m

NAME                             DESIRED   CURRENT   READY   AGE
replicaset.apps/app-5646649cc9   1         1         0       20m

controlplane ~ ➜  k get pod -n kube-system 
NAME                                   READY   STATUS    RESTARTS   AGE
coredns-69f9c977-4jtb2                 1/1     Running   0          25m
coredns-69f9c977-rs97l                 1/1     Running   0          25m
etcd-controlplane                      1/1     Running   0          25m
kube-apiserver-controlplane            1/1     Running   0          25m
kube-controller-manager-controlplane   1/1     Running   0          25m
kube-proxy-7c6sj                       1/1     Running   0          25m
kube-scheduler-controlplane            0/1     Running   0          11s

controlplane ~ ➜  k get pod -n kube-system 
NAME                                   READY   STATUS    RESTARTS   AGE
coredns-69f9c977-4jtb2                 1/1     Running   0          25m
coredns-69f9c977-rs97l                 1/1     Running   0          25m
etcd-controlplane                      1/1     Running   0          25m
kube-apiserver-controlplane            1/1     Running   0          26m
kube-controller-manager-controlplane   1/1     Running   0          25m
kube-proxy-7c6sj                       1/1     Running   0          25m
kube-scheduler-controlplane            0/1     Running   0          19s

controlplane ~ ➜  k get pod -n kube-system 
NAME                                   READY   STATUS    RESTARTS   AGE
coredns-69f9c977-4jtb2                 1/1     Running   0          25m
coredns-69f9c977-rs97l                 1/1     Running   0          25m
etcd-controlplane                      1/1     Running   0          26m
kube-apiserver-controlplane            1/1     Running   0          26m
kube-controller-manager-controlplane   1/1     Running   0          26m
kube-proxy-7c6sj                       1/1     Running   0          25m
kube-scheduler-controlplane            1/1     Running   0          25s

controlplane ~ ➜  k get pod
NAME                   READY   STATUS    RESTARTS   AGE
app-5646649cc9-2ktpt   1/1     Running   0          21m

controlplane ~ ➜  
```
