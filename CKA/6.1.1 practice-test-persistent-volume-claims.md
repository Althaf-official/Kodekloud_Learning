### We have deployed a POD. Inspect the POD and wait for it to start running.

In the current(default) namespace.

```ruby
controlplane ~ ➜  kubectl get pod
NAME     READY   STATUS    RESTARTS   AGE
webapp   1/1     Running   0          36s

controlplane ~ ➜  kubectl describe pod
Name:             webapp
Namespace:        default
Priority:         0
Service Account:  default
Node:             controlplane/192.11.108.8
Start Time:       Sun, 25 Feb 2024 07:08:30 +0000
Labels:           <none>
Annotations:      <none>
Status:           Running
IP:               10.244.0.4
IPs:
  IP:  10.244.0.4
Containers:
  event-simulator:
    Container ID:   containerd://0c8b271830c4778ab9e290fc0bba517a9e8bf1103198b5195bd3c72292d94ee3
    Image:          kodekloud/event-simulator
    Image ID:       docker.io/kodekloud/event-simulator@sha256:1e3e9c72136bbc76c96dd98f29c04f298c3ae241c7d44e2bf70bcc209b030bf9
    Port:           <none>
    Host Port:      <none>
    State:          Running
      Started:      Sun, 25 Feb 2024 07:08:34 +0000
    Ready:          True
    Restart Count:  0
    Environment:
      LOG_HANDLERS:  file
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-2blmh (ro)
Conditions:
  Type                        Status
  PodReadyToStartContainers   True 
  Initialized                 True 
  Ready                       True 
  ContainersReady             True 
  PodScheduled                True 
Volumes:
  kube-api-access-2blmh:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   BestEffort
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  45s   default-scheduler  Successfully assigned default/webapp to controlplane
  Normal  Pulling    44s   kubelet            Pulling image "kodekloud/event-simulator"
  Normal  Pulled     42s   kubelet            Successfully pulled image "kodekloud/event-simulator" in 2.674s (2.674s including waiting)
  Normal  Created    42s   kubelet            Created container event-simulator
  Normal  Started    41s   kubelet            Started container event-simulator

controlplane ~ ➜  
```

### The application stores logs at location ```/log/app.log```. View the logs.


You can exec in to the container and open the file:

    kubectl exec webapp -- cat /log/app.log

```ruby
controlplane ~ ➜  kubectl exec webapp -- cat /log/app.log
[2024-02-25 07:08:34,317] INFO in event-simulator: USER4 is viewing page2
[2024-02-25 07:08:35,317] INFO in event-simulator: USER3 is viewing page2
[2024-02-25 07:08:36,318] INFO in event-simulator: USER2 is viewing page3
[2024-02-25 07:08:37,318] INFO in event-simulator: USER4 logged out
[2024-02-25 07:08:38,320] INFO in event-simulator: USER3 is viewing page1
[2024-02-25 07:08:39,321] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:08:39,321] INFO in event-simulator: USER4 logged in
[2024-02-25 07:08:40,322] INFO in event-simulator: USER1 is viewing page2
[2024-02-25 07:08:41,323] INFO in event-simulator: USER1 logged in
[2024-02-25 07:08:42,324] WARNING in event-simulator: USER7 Order failed as the item is OUT OF STOCK.
[2024-02-25 07:08:42,324] INFO in event-simulator: USER4 is viewing page3
[2024-02-25 07:08:43,325] INFO in event-simulator: USER4 is viewing page3
[2024-02-25 07:08:44,326] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:08:44,326] INFO in event-simulator: USER1 logged out
[2024-02-25 07:08:45,327] INFO in event-simulator: USER1 logged out
[2024-02-25 07:08:46,329] INFO in event-simulator: USER3 logged in
[2024-02-25 07:08:47,330] INFO in event-simulator: USER2 is viewing page2
[2024-02-25 07:08:48,331] INFO in event-simulator: USER4 is viewing page2
[2024-02-25 07:08:49,332] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:08:49,333] INFO in event-simulator: USER2 is viewing page1
[2024-02-25 07:08:50,333] WARNING in event-simulator: USER7 Order failed as the item is OUT OF STOCK.
[2024-02-25 07:08:50,333] INFO in event-simulator: USER2 logged out
[2024-02-25 07:08:51,334] INFO in event-simulator: USER4 logged out
[2024-02-25 07:08:52,335] INFO in event-simulator: USER1 is viewing page1
[2024-02-25 07:08:53,336] INFO in event-simulator: USER1 is viewing page1
[2024-02-25 07:08:54,338] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:08:54,338] INFO in event-simulator: USER3 is viewing page3
[2024-02-25 07:08:55,339] INFO in event-simulator: USER1 is viewing page1
[2024-02-25 07:08:56,340] INFO in event-simulator: USER4 logged in
[2024-02-25 07:08:57,342] INFO in event-simulator: USER1 is viewing page1
[2024-02-25 07:08:58,343] WARNING in event-simulator: USER7 Order failed as the item is OUT OF STOCK.
[2024-02-25 07:08:58,343] INFO in event-simulator: USER4 is viewing page1
[2024-02-25 07:08:59,344] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:08:59,345] INFO in event-simulator: USER2 is viewing page2
[2024-02-25 07:09:00,345] INFO in event-simulator: USER2 is viewing page1
[2024-02-25 07:09:01,346] INFO in event-simulator: USER2 logged out
[2024-02-25 07:09:02,347] INFO in event-simulator: USER1 logged out
[2024-02-25 07:09:03,348] INFO in event-simulator: USER2 is viewing page3
[2024-02-25 07:09:04,349] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:09:04,349] INFO in event-simulator: USER1 logged in
[2024-02-25 07:09:05,350] INFO in event-simulator: USER1 logged in
[2024-02-25 07:09:06,351] WARNING in event-simulator: USER7 Order failed as the item is OUT OF STOCK.
[2024-02-25 07:09:06,351] INFO in event-simulator: USER1 logged in
[2024-02-25 07:09:07,352] INFO in event-simulator: USER1 is viewing page3
[2024-02-25 07:09:08,353] INFO in event-simulator: USER4 is viewing page3
[2024-02-25 07:09:09,354] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:09:09,354] INFO in event-simulator: USER2 is viewing page2
[2024-02-25 07:09:10,355] INFO in event-simulator: USER2 logged out
[2024-02-25 07:09:11,357] INFO in event-simulator: USER4 is viewing page2
[2024-02-25 07:09:12,358] INFO in event-simulator: USER3 is viewing page2
[2024-02-25 07:09:13,359] INFO in event-simulator: USER1 is viewing page3
[2024-02-25 07:09:14,360] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:09:14,360] WARNING in event-simulator: USER7 Order failed as the item is OUT OF STOCK.
[2024-02-25 07:09:14,360] INFO in event-simulator: USER2 logged in
[2024-02-25 07:09:15,361] INFO in event-simulator: USER3 is viewing page1
[2024-02-25 07:09:16,362] INFO in event-simulator: USER4 is viewing page3
[2024-02-25 07:09:17,363] INFO in event-simulator: USER2 is viewing page1
[2024-02-25 07:09:18,364] INFO in event-simulator: USER2 logged out
[2024-02-25 07:09:19,365] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:09:19,365] INFO in event-simulator: USER2 is viewing page1
[2024-02-25 07:09:20,366] INFO in event-simulator: USER3 logged in
[2024-02-25 07:09:21,367] INFO in event-simulator: USER2 logged out
[2024-02-25 07:09:22,368] WARNING in event-simulator: USER7 Order failed as the item is OUT OF STOCK.
[2024-02-25 07:09:22,369] INFO in event-simulator: USER2 logged in
[2024-02-25 07:09:23,370] INFO in event-simulator: USER3 is viewing page1
[2024-02-25 07:09:24,371] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:09:24,371] INFO in event-simulator: USER4 is viewing page1
[2024-02-25 07:09:25,373] INFO in event-simulator: USER1 is viewing page1
[2024-02-25 07:09:26,374] INFO in event-simulator: USER1 is viewing page3
[2024-02-25 07:09:27,375] INFO in event-simulator: USER2 logged in
[2024-02-25 07:09:28,376] INFO in event-simulator: USER2 is viewing page3
[2024-02-25 07:09:29,378] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:09:29,378] INFO in event-simulator: USER4 is viewing page1
[2024-02-25 07:09:30,378] WARNING in event-simulator: USER7 Order failed as the item is OUT OF STOCK.
[2024-02-25 07:09:30,379] INFO in event-simulator: USER4 logged in
[2024-02-25 07:09:31,380] INFO in event-simulator: USER1 logged out
[2024-02-25 07:09:32,381] INFO in event-simulator: USER2 is viewing page3
[2024-02-25 07:09:33,382] INFO in event-simulator: USER4 logged out
[2024-02-25 07:09:34,383] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:09:34,383] INFO in event-simulator: USER4 is viewing page3
[2024-02-25 07:09:35,384] INFO in event-simulator: USER1 logged in
[2024-02-25 07:09:36,385] INFO in event-simulator: USER1 logged in
[2024-02-25 07:09:37,386] INFO in event-simulator: USER3 logged in
[2024-02-25 07:09:38,387] WARNING in event-simulator: USER7 Order failed as the item is OUT OF STOCK.
[2024-02-25 07:09:38,387] INFO in event-simulator: USER4 logged out
[2024-02-25 07:09:39,388] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:09:39,389] INFO in event-simulator: USER3 logged in
[2024-02-25 07:09:40,390] INFO in event-simulator: USER4 is viewing page2
[2024-02-25 07:09:41,390] INFO in event-simulator: USER1 is viewing page3
[2024-02-25 07:09:42,392] INFO in event-simulator: USER1 logged in
[2024-02-25 07:09:43,392] INFO in event-simulator: USER3 logged out
[2024-02-25 07:09:44,393] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:09:44,394] INFO in event-simulator: USER4 is viewing page2
[2024-02-25 07:09:45,395] INFO in event-simulator: USER4 logged in
[2024-02-25 07:09:46,396] WARNING in event-simulator: USER7 Order failed as the item is OUT OF STOCK.
[2024-02-25 07:09:46,396] INFO in event-simulator: USER1 logged in
[2024-02-25 07:09:47,397] INFO in event-simulator: USER1 logged in
[2024-02-25 07:09:48,398] INFO in event-simulator: USER3 is viewing page3
[2024-02-25 07:09:49,399] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:09:49,399] INFO in event-simulator: USER4 logged in
[2024-02-25 07:09:50,400] INFO in event-simulator: USER4 is viewing page3
[2024-02-25 07:09:51,401] INFO in event-simulator: USER3 is viewing page3
[2024-02-25 07:09:52,402] INFO in event-simulator: USER4 is viewing page1
[2024-02-25 07:09:53,403] INFO in event-simulator: USER4 logged in
[2024-02-25 07:09:54,403] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:09:54,403] WARNING in event-simulator: USER7 Order failed as the item is OUT OF STOCK.
[2024-02-25 07:09:54,404] INFO in event-simulator: USER2 is viewing page3
[2024-02-25 07:09:55,405] INFO in event-simulator: USER2 logged in
[2024-02-25 07:09:56,405] INFO in event-simulator: USER3 is viewing page2
[2024-02-25 07:09:57,406] INFO in event-simulator: USER1 is viewing page3
[2024-02-25 07:09:58,407] INFO in event-simulator: USER3 logged out
[2024-02-25 07:09:59,408] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:09:59,409] INFO in event-simulator: USER2 is viewing page1
[2024-02-25 07:10:00,409] INFO in event-simulator: USER2 is viewing page3
[2024-02-25 07:10:01,410] INFO in event-simulator: USER2 is viewing page2
[2024-02-25 07:10:02,411] WARNING in event-simulator: USER7 Order failed as the item is OUT OF STOCK.
[2024-02-25 07:10:02,411] INFO in event-simulator: USER2 is viewing page1
[2024-02-25 07:10:03,411] INFO in event-simulator: USER3 logged in
[2024-02-25 07:10:04,412] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:10:04,412] INFO in event-simulator: USER4 is viewing page2
[2024-02-25 07:10:05,413] INFO in event-simulator: USER1 logged out
[2024-02-25 07:10:06,414] INFO in event-simulator: USER4 is viewing page1
[2024-02-25 07:10:07,415] INFO in event-simulator: USER2 is viewing page1
[2024-02-25 07:10:08,416] INFO in event-simulator: USER3 logged out
[2024-02-25 07:10:09,417] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:10:09,417] INFO in event-simulator: USER1 is viewing page3
[2024-02-25 07:10:10,418] WARNING in event-simulator: USER7 Order failed as the item is OUT OF STOCK.
[2024-02-25 07:10:10,418] INFO in event-simulator: USER1 is viewing page3
[2024-02-25 07:10:11,419] INFO in event-simulator: USER1 logged out
[2024-02-25 07:10:12,420] INFO in event-simulator: USER3 logged in
[2024-02-25 07:10:13,421] INFO in event-simulator: USER1 is viewing page1
[2024-02-25 07:10:14,422] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:10:14,422] INFO in event-simulator: USER2 is viewing page3
[2024-02-25 07:10:15,423] INFO in event-simulator: USER1 is viewing page2
[2024-02-25 07:10:16,424] INFO in event-simulator: USER2 is viewing page3
[2024-02-25 07:10:17,426] INFO in event-simulator: USER4 is viewing page2
[2024-02-25 07:10:18,427] WARNING in event-simulator: USER7 Order failed as the item is OUT OF STOCK.
[2024-02-25 07:10:18,427] INFO in event-simulator: USER1 is viewing page2
[2024-02-25 07:10:19,428] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:10:19,428] INFO in event-simulator: USER3 is viewing page2
[2024-02-25 07:10:20,430] INFO in event-simulator: USER1 logged out
[2024-02-25 07:10:21,430] INFO in event-simulator: USER1 logged in
[2024-02-25 07:10:22,431] INFO in event-simulator: USER2 is viewing page1
[2024-02-25 07:10:23,433] INFO in event-simulator: USER2 is viewing page1
[2024-02-25 07:10:24,434] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:10:24,434] INFO in event-simulator: USER1 is viewing page2
[2024-02-25 07:10:25,435] INFO in event-simulator: USER2 logged in
[2024-02-25 07:10:26,437] WARNING in event-simulator: USER7 Order failed as the item is OUT OF STOCK.
[2024-02-25 07:10:26,437] INFO in event-simulator: USER4 is viewing page1
[2024-02-25 07:10:27,438] INFO in event-simulator: USER4 is viewing page1
[2024-02-25 07:10:28,439] INFO in event-simulator: USER1 is viewing page2
[2024-02-25 07:10:29,441] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:10:29,441] INFO in event-simulator: USER4 is viewing page1
[2024-02-25 07:10:30,442] INFO in event-simulator: USER1 is viewing page3
[2024-02-25 07:10:31,443] INFO in event-simulator: USER2 logged out
[2024-02-25 07:10:32,444] INFO in event-simulator: USER1 is viewing page1
[2024-02-25 07:10:33,446] INFO in event-simulator: USER4 logged out
[2024-02-25 07:10:34,447] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:10:34,447] WARNING in event-simulator: USER7 Order failed as the item is OUT OF STOCK.
[2024-02-25 07:10:34,447] INFO in event-simulator: USER2 logged out
[2024-02-25 07:10:35,449] INFO in event-simulator: USER1 is viewing page1
[2024-02-25 07:10:36,450] INFO in event-simulator: USER4 is viewing page2
[2024-02-25 07:10:37,450] INFO in event-simulator: USER1 is viewing page1
[2024-02-25 07:10:38,452] INFO in event-simulator: USER3 is viewing page1
[2024-02-25 07:10:39,453] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:10:39,453] INFO in event-simulator: USER1 logged out
[2024-02-25 07:10:40,454] INFO in event-simulator: USER4 is viewing page3
[2024-02-25 07:10:41,455] INFO in event-simulator: USER2 is viewing page3
[2024-02-25 07:10:42,456] WARNING in event-simulator: USER7 Order failed as the item is OUT OF STOCK.
[2024-02-25 07:10:42,456] INFO in event-simulator: USER4 logged in
[2024-02-25 07:10:43,458] INFO in event-simulator: USER2 logged out
[2024-02-25 07:10:44,459] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:10:44,459] INFO in event-simulator: USER1 is viewing page3
[2024-02-25 07:10:45,460] INFO in event-simulator: USER3 is viewing page1
[2024-02-25 07:10:46,462] INFO in event-simulator: USER4 is viewing page2
[2024-02-25 07:10:47,463] INFO in event-simulator: USER3 is viewing page3
[2024-02-25 07:10:48,464] INFO in event-simulator: USER2 is viewing page2
[2024-02-25 07:10:49,465] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
[2024-02-25 07:10:49,466] INFO in event-simulator: USER4 is viewing page2
[2024-02-25 07:10:50,467] WARNING in event-simulator: USER7 Order failed as the item is OUT OF STOCK.
[2024-02-25 07:10:50,467] INFO in event-simulator: USER2 is viewing page3
[2024-02-25 07:10:51,468] INFO in event-simulator: USER4 logged out
[2024-02-25 07:10:52,469] INFO in event-simulator: USER3 is viewing page3

controlplane ~ ➜  
```
### If the POD was to get deleted now, would you be able to view these logs.

##### The logs are stored in the Container's file system that lives only as long as the Container does. Once the pod is destroyed, you cannot view the logs again.

### Configure a volume to store these logs at ```/var/log/webapp``` on the host.


Use the spec provided below.




    Name: webapp
    
    Image Name: kodekloud/event-simulator
    
    Volume HostPath: /var/log/webapp
    
    Volume Mount: /log



Use the command kubectl get po webapp -o yaml > webapp.yaml and add the given properties under the ```spec.volumes``` and ```spec.containers.volumeMounts```.

OR

Use the command ```kubectl run``` to create a new pod and use the flag ```--dry-run=client -o yaml``` to generate the manifest file.

In the manifest file add ```spec.volumes``` and ```spec.containers.volumeMounts``` property.



After that, run the following command to create a pod called webapp: -

```kubectl replace -f webapp.yaml --force```


```kubectl replace -f```: - It will remove the existing resource and will replace it with the new one from the given manifest file.

OR

First delete the existing pod by running the following command: -

    kubectl delete po webapp

    
then use the below manifest file to create a webapp pod with given properties as follows:

    apiVersion: v1
    kind: Pod
    metadata:
      name: webapp
    spec:
      containers:
      - name: event-simulator
        image: kodekloud/event-simulator
        env:
        - name: LOG_HANDLERS
          value: file
        volumeMounts:
        - mountPath: /log
          name: log-volume
    
      volumes:
      - name: log-volume
        hostPath:
          # directory location on host
          path: /var/log/webapp
          # this field is optional
          type: Directory

          
Then run the command kubectl create -f <file-name>.yaml to create a pod.


```ruby
controlplane ~ ➜  kubectl get pod
NAME     READY   STATUS    RESTARTS   AGE
webapp   1/1     Running   0          9m4s

controlplane ~ ➜  ls
sample.yaml

controlplane ~ ➜  kubectl delete pod webapp --force 
Warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
pod "webapp" force deleted

controlplane ~ ➜  k get po
No resources found in default namespace.

controlplane ~ ➜  cat > sample.yaml 
apiVersion: v1
kind: Pod
metadata:
  name: webapp
spec:
  containers:
  - name: event-simulator
    image: kodekloud/event-simulator
    env:
    - name: LOG_HANDLERS
      value: file
    volumeMounts:
    - mountPath: /log
      name: log-volume

  volumes:
  - name: log-volume
    hostPath:
      # directory location on host
      path: /var/log/webapp
      # this field is optional
      type: Directory
controlplane ~ ➜  k create -f sample.yaml 
pod/webapp created

controlplane ~ ➜  k get po
NAME     READY   STATUS    RESTARTS   AGE
webapp   1/1     Running   0          4s
```


### Create a Persistent Volume with the given specification.





    Volume Name: pv-log
    
    Storage: 100Mi
    
    Access Modes: ReadWriteMany
    
    Host Path: /pv/log
    
    Reclaim Policy: Retain



---

Use the following manifest file to create a ```pv-log``` persistent volume:

    apiVersion: v1
    kind: PersistentVolume
    metadata:
      name: pv-log
    spec:
      persistentVolumeReclaimPolicy: Retain
      accessModes:
        - ReadWriteMany
      capacity:
        storage: 100Mi
      hostPath:
        path: /pv/log

        
Then run the command ```kubectl create -f <file-name>.yaml``` to create a PV from manifest file.

```ruby
controlplane ~ ➜  cat > sample.yaml 
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv-log
spec:
  persistentVolumeReclaimPolicy: Retain
  accessModes:
    - ReadWriteMany
  capacity:
    storage: 100Mi
  hostPath:
    path: /pv/log
controlplane ~ ➜  k create -f sample.yaml 
persistentvolume/pv-log created

controlplane ~ ➜  k get pv
NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE
pv-log   100Mi      RWX            Retain           Available                          <unset>                          8s

controlplane ~ ➜  k describe pv pv-log 
Name:            pv-log
Labels:          <none>
Annotations:     <none>
Finalizers:      [kubernetes.io/pv-protection]
StorageClass:    
Status:          Available
Claim:           
Reclaim Policy:  Retain
Access Modes:    RWX
VolumeMode:      Filesystem
Capacity:        100Mi
Node Affinity:   <none>
Message:         
Source:
    Type:          HostPath (bare host directory volume)
    Path:          /pv/log
    HostPathType:  
Events:            <none>

controlplane ~ ➜  
```

### Let us claim some of that storage for our application. Create a Persistent Volume Claim with the given specification.





    Volume Name: claim-log-1
    
    Storage Request: 50Mi
    
    Access Modes: ReadWriteOnce

Solution manifest file to create a ```claim-log-1``` PVC with given properties as follows:


    kind: PersistentVolumeClaim
    apiVersion: v1
    metadata:
      name: claim-log-1
    spec:
      accessModes:
        - ReadWriteOnce
      resources:
        requests:
          storage: 50Mi

          
Then run ```kubectl create -f <file-name>.yaml```` to create a PVC from the manifest file.


```ruby
controlplane ~ ➜  cat > sample.yaml 
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: claim-log-1
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 50Mi
controlplane ~ ➜  k create -f sample.yaml 
persistentvolumeclaim/claim-log-1 created

controlplane ~ ➜  k get pvc
NAME          STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
claim-log-1   Pending                                                     <unset>                 8s

controlplane ~ ➜  k describe pvc
Name:          claim-log-1
Namespace:     default
StorageClass:  
Status:        Pending
Volume:        
Labels:        <none>
Annotations:   <none>
Finalizers:    [kubernetes.io/pvc-protection]
Capacity:      
Access Modes:  
VolumeMode:    Filesystem
Used By:       <none>
Events:
  Type    Reason         Age                From                         Message
  ----    ------         ----               ----                         -------
  Normal  FailedBinding  11s (x2 over 15s)  persistentvolume-controller  no persistent volumes available for this claim and no storage class is set

controlplane ~ ➜  
```

### What is the state of the Persistent Volume Claim?


```ruby

controlplane ~ ➜  k get pvc
NAME          STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
claim-log-1   Pending                                                     <unset>                 8s

controlplane ~ ➜  k describe pvc
Name:          claim-log-1
Namespace:     default
StorageClass:  
Status:        Pending
Volume:        
Labels:        <none>
Annotations:   <none>
Finalizers:    [kubernetes.io/pvc-protection]
Capacity:      
Access Modes:  
VolumeMode:    Filesystem
Used By:       <none>
Events:
  Type    Reason         Age                From                         Message
  ----    ------         ----               ----                         -------
  Normal  FailedBinding  11s (x2 over 15s)  persistentvolume-controller  no persistent volumes available for this claim and no storage class is set

controlplane ~ ➜  
```

    PENDING

### What is the state of the Persistent Volume?

```ruby

controlplane ~ ➜  k get pv
NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE
pv-log   100Mi      RWX            Retain           Available                          <unset>                          7m16s

controlplane ~ ➜  
```

    Available

### Why is the claim not bound to the available ```Persistent Volume```?

Run the command:   ```kubectl get pv,pvc``` and look at the ```Access Modes```.

    The Access Modes set on the PV and the PVC do not match.

```ruby
controlplane ~ ✖ k get pv,pvc
NAME                      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE
persistentvolume/pv-log   100Mi      RWX            Retain           Available                          <unset>                          9m47s

NAME                                STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/claim-log-1   Pending                                                     <unset>                 6m8s

controlplane ~ ➜  
```

### Update the Access Mode on the claim to bind it to the PV.


Delete and recreate the ```claim-log-1```.




    Volume Name: claim-log-1
    
    Storage Request: 50Mi
    
    PVol: pv-log
    
    Status: Bound


Set the Access Mode on the PVC to ```ReadWriteMany```

To delete the existing pvc:

$ kubectl delete pvc claim-log-1

Solution manifest file to create a claim-log-1 PVC with correct Access Modes as follows:

    kind: PersistentVolumeClaim
    apiVersion: v1
    metadata:
      name: claim-log-1
    spec:
      accessModes:
        - ReadWriteMany
      resources:
        requests:
          storage: 50Mi
          
Then run ```kubectl create -f <file-name>.yaml```

```ruby
controlplane ~ ➜  k describe pvc 
Name:          claim-log-1
Namespace:     default
StorageClass:  
Status:        Pending
Volume:        
Labels:        <none>
Annotations:   <none>
Finalizers:    [kubernetes.io/pvc-protection]
Capacity:      
Access Modes:  
VolumeMode:    Filesystem
Used By:       <none>
Events:
  Type    Reason         Age                  From                         Message
  ----    ------         ----                 ----                         -------
  Normal  FailedBinding  2m56s (x26 over 9m)  persistentvolume-controller  no persistent volumes available for this claim and no storage class is set

controlplane ~ ➜  k delete pvc claim-log-1 
persistentvolumeclaim "claim-log-1" deleted

controlplane ~ ➜  k get pvc
No resources found in default namespace.

controlplane ~ ➜  cat > sample.yaml 
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: claim-log-1
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 50Mi
controlplane ~ ➜  k create -f sample.yaml 
persistentvolumeclaim/claim-log-1 created

controlplane ~ ➜  k get pvc,pv
NAME                                STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/claim-log-1   Bound    pv-log   100Mi      RWX                           <unset>                 8s

NAME                      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                 STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE
persistentvolume/pv-log   100Mi      RWX            Retain           Bound    default/claim-log-1                  <unset>                          13m

controlplane ~ ➜  
```


### You requested for ```50Mi``, how much capacity is now available to the PVC?

Run the command: ```kubectl get pvc``` and look under the capacity section.


```ruby
controlplane ~ ➜  k get pvc
NAME          STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
claim-log-1   Bound    pv-log   100Mi      RWX                           <unset>                 3m40s

controlplane ~ ➜  
```

    100Mi

### Update the webapp pod to use the persistent volume claim as its storage.


Replace hostPath configured earlier with the newly created PersistentVolumeClaim.




    Name: webapp
    
    Image Name: kodekloud/event-simulator
    
    Volume: PersistentVolumeClaim=claim-log-1
    
    Volume Mount: /log

To delete the webapp pod first:

    kubectl delete po webapp

Add ```--force``` flag in above command, if you would like to delete the pod without any delay.

To create a new webapp pod with given properties as follows:

    apiVersion: v1
    kind: Pod
    metadata:
      name: webapp
    spec:
      containers:
      - name: event-simulator
        image: kodekloud/event-simulator
        env:
        - name: LOG_HANDLERS
          value: file
        volumeMounts:
        - mountPath: /log
          name: log-volume
    
      volumes:
      - name: log-volume
        persistentVolumeClaim:
          claimName: claim-log-1

          
Then run the command kubectl create -f <file-name>.yaml to create a pod from the definition file.

```ruby
controlplane ~ ➜  k delete po webapp 
pod "webapp" deleted

controlplane ~ ➜  cat > sample.yaml 
apiVersion: v1
kind: Pod
metadata:
  name: webapp
spec:
  containers:
  - name: event-simulator
    image: kodekloud/event-simulator
    env:
    - name: LOG_HANDLERS
      value: file
    volumeMounts:
    - mountPath: /log
      name: log-volume

  volumes:
  - name: log-volume
    persistentVolumeClaim:
      claimName: claim-log-1
controlplane ~ ➜  k create -f sample.yaml 
pod/webapp created

controlplane ~ ➜  k get pod
NAME     READY   STATUS    RESTARTS   AGE
webapp   1/1     Running   0          5s

controlplane ~ ➜  k describe pod webapp 
Name:             webapp
Namespace:        default
Priority:         0
Service Account:  default
Node:             controlplane/192.11.108.8
Start Time:       Sun, 25 Feb 2024 07:44:00 +0000
Labels:           <none>
Annotations:      <none>
Status:           Running
IP:               10.244.0.6
IPs:
  IP:  10.244.0.6
Containers:
  event-simulator:
    Container ID:   containerd://10bac9d2774f492439fff507fd79c6fb260536b4d3a438958f6fa1ba3c405304
    Image:          kodekloud/event-simulator
    Image ID:       docker.io/kodekloud/event-simulator@sha256:1e3e9c72136bbc76c96dd98f29c04f298c3ae241c7d44e2bf70bcc209b030bf9
    Port:           <none>
    Host Port:      <none>
    State:          Running
      Started:      Sun, 25 Feb 2024 07:44:01 +0000
    Ready:          True
    Restart Count:  0
    Environment:
      LOG_HANDLERS:  file
    Mounts:
      /log from log-volume (rw)
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-4pdwz (ro)
Conditions:
  Type                        Status
  PodReadyToStartContainers   True 
  Initialized                 True 
  Ready                       True 
  ContainersReady             True 
  PodScheduled                True 
Volumes:
  log-volume:
    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim in the same namespace)
    ClaimName:  claim-log-1
    ReadOnly:   false
  kube-api-access-4pdwz:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   BestEffort
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  11s   default-scheduler  Successfully assigned default/webapp to controlplane
  Normal  Pulling    11s   kubelet            Pulling image "kodekloud/event-simulator"
  Normal  Pulled     10s   kubelet            Successfully pulled image "kodekloud/event-simulator" in 286ms (286ms including waiting)
  Normal  Created    10s   kubelet            Created container event-simulator
  Normal  Started    10s   kubelet            Started container event-simulator

controlplane ~ ➜  
```

### What is the ```Reclaim Policy``` set on the Persistent Volume ```pv-log```?

```ruby
controlplane ~ ➜  k get pv
NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                 STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE
pv-log   100Mi      RWX            Retain           Bound    default/claim-log-1                  <unset>                          23m

controlplane ~ ➜  
```

    Retain  

### What would happen to the PV if the PVC was destroyed?

![image](https://github.com/Althaf-official/Kodekloud_Learning/assets/105126131/c412a66a-0f4a-4f9f-bedf-d0bd6124fff2)

    3rd option

### Try deleting the PVC and notice what happens.

If the command hangs, you can use CTRL + C to get back to the bash prompt OR check the status of the pvc from another terminal


```ruby
controlplane ~ ➜  k delete pvc claim-log-1 --force
Warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
persistentvolumeclaim "claim-log-1" force deleted


Ctrl+C

controlplane ~ ➜  k get pvc
NAME          STATUS        VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
claim-log-1   Terminating   pv-log   100Mi      RWX                           <unset>                 14m

controlplane ~ ➜  

```

    The PVC is stuck in the terminating state

### Why is the ```PVC``` stuck in ```Terminating``` state?


The PVC was still being used by the ```webapp``` pod when we issued the delete command. Until the pod is deleted, the PVC will remain in a ```terminating``` state.


### Let us now delete the webapp Pod.


Once deleted, wait for the pod to fully terminate.

```ruby
controlplane ~ ➜  k get pvc
NAME          STATUS        VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
claim-log-1   Terminating   pv-log   100Mi      RWX                           <unset>                 14m

controlplane ~ ➜  k delete pod webapp --force 
Warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
pod "webapp" force deleted

controlplane ~ ➜  k get pvc
No resources found in default namespace.

controlplane ~ ➜  
```

### What is the state of the PVC now?


    controlplane ~ ➜  k get pvc
    No resources found in default namespace

### What is the state of the Persistent Volume now?


Run the command: ```kubectl get pv``` and look under the status section.

```ruby
controlplane ~ ➜  k get pv
NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS     CLAIM                 STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE
pv-log   100Mi      RWX            Retain           Released   default/claim-log-1                  <unset>                          33m

controlplane ~ ➜  

```

     Released
