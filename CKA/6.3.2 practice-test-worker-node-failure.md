### Fix the broken cluster




Step1: Check the status of the nodes:

controlplane:~> kubectl get nodes
NAME           STATUS     ROLES           AGE   VERSION
controlplane   Ready      control-plane   19m   v1.27.0
node01         NotReady   <none>          19m   v1.27.0

controlplane:~> 


    Step 2: SSH to node01 and check the status of the container runtime (containerd, in this case) and the kubelet service.

   
    
----
    
    root@node01:~> systemctl status containerd
    ● containerd.service - containerd container runtime
         Loaded: loaded (/lib/systemd/system/containerd.service; enabled; vendor preset: enabled)
         Active: active (running) since Tue 2023-05-30 12:45:03 EDT; 20min ago
           Docs: https://containerd.io
       Main PID: 995 (containerd)
          Tasks: 100
         Memory: 146.8M
         CGroup: /system.slice/containerd.service
                 ├─ 995 /usr/bin/containerd

    root@node01:~>
    
    root@node01:~> systemctl status kubelet
    ● kubelet.service - kubelet: The Kubernetes Node Agent
         Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)
        Drop-In: /etc/systemd/system/kubelet.service.d
                 └─10-kubeadm.conf
         Active: inactive (dead) since Tue 2023-05-30 12:47:30 EDT; 18min ago
           Docs: https://kubernetes.io/docs/home/
        Process: 1978 ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS (code=exited, status=0/S>
       Main PID: 1978 (code=exited, status=0/SUCCESS)
Since the kubelet is not running, attempt to start it by running the following command:

    root@node01:~> systemctl start kubelet

    root@node01:~> systemctl status kubelet
● kubelet.service - kubelet: The Kubernetes Node Agent
         Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)
        Drop-In: /etc/systemd/system/kubelet.service.d
                 └─10-kubeadm.conf
         Active: active (running) since Tue 2023-05-30 13:06:47 EDT; 6s ago
           Docs: https://kubernetes.io/docs/home/
       Main PID: 4313 (kubelet)
          Tasks: 15 (limit: 77091)
         Memory: 31.4M
         CGroup: /system.slice/kubelet.service
node01 should go back to ready state now.



```ruby

controlplane ~ ➜  k get all
NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   6m55s

controlplane ~ ➜  k get  nodes
NAME           STATUS     ROLES           AGE     VERSION
controlplane   Ready      control-plane   7m4s    v1.29.0
node01         NotReady   <none>          6m18s   v1.29.0

controlplane ~ ➜  journalctl -u kubelet
May 20 10:38:21 controlplane kubelet[1194]: E0520 10:38:21.628990    1194 run.go:74] "comm>
May 20 10:38:31 controlplane kubelet[2432]: E0520 10:38:31.750939    2432 run.go:74] "comm>
May 20 10:38:37 controlplane kubelet[3083]: Flag --container-runtime-endpoint has been dep>
May 20 10:38:37 controlplane kubelet[3083]: Flag --pod-infra-container-image has been depr>
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.364240    3083 server.go:204] ">
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.656693    3083 server.go:487] ">
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.656737    3083 server.go:489] ">
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.657033    3083 server.go:919] ">
May 20 10:38:37 controlplane kubelet[3083]: E0520 10:38:37.661821    3083 certificate_mana>
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.661980    3083 dynamic_cafile_c>
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.736385    3083 server.go:745] ">
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.745683    3083 container_manage>
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.745886    3083 container_manage>
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.747081    3083 topology_manager>
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.747113    3083 container_manage>
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.748117    3083 state_mem.go:36]>
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.748243    3083 kubelet.go:396] >
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.748262    3083 kubelet.go:301] >
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.748288    3083 kubelet.go:312] >
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.748302    3083 apiserver.go:42]>
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.748949    3083 kuberuntime_mana>
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.749318    3083 kubelet.go:809] >
May 20 10:38:37 controlplane kubelet[3083]: W0520 10:38:37.749386    3083 probe.go:268] Fl>
May 20 10:38:37 controlplane kubelet[3083]: W0520 10:38:37.749639    3083 reflector.go:539>
May 20 10:38:37 controlplane kubelet[3083]: E0520 10:38:37.749734    3083 reflector.go:147>
May 20 10:38:37 controlplane kubelet[3083]: W0520 10:38:37.749761    3083 reflector.go:539>
May 20 10:38:37 controlplane kubelet[3083]: E0520 10:38:37.749846    3083 reflector.go:147>
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.758965    3083 server.go:1256] >
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.759061    3083 server.go:162] ">
May 20 10:38:37 controlplane kubelet[3083]: I0520 10:38:37.759227    3083 ratelimit.go:55]>
lines 1-30

controlplane ~ ✖ ssh node01

node01 ~ ➜  systemctl status containerd
● containerd.service - containerd container runtime
     Loaded: loaded (/lib/systemd/system/containerd.service; enabled; vendor preset: enabl>
     Active: active (running) since Mon 2024-05-20 10:38:21 UTC; 9min ago
       Docs: https://containerd.io
   Main PID: 1174 (containerd)
      Tasks: 92
     Memory: 114.9M
     CGroup: /system.slice/containerd.service
             ├─1174 /usr/bin/containerd
             ├─2720 /usr/bin/containerd-shim-runc-v2 -namespace k8s.io -id a132d5f3165e0fe>
             ├─2721 /usr/bin/containerd-shim-runc-v2 -namespace k8s.io -id cb3ecd3c9727464>
             ├─kubepods-besteffort-pod0d08528f_4fe7_413c_9501_fc82cbee4036.slice:cri-conta>
             │ └─2974 /usr/local/bin/kube-proxy --config=/var/lib/kube-proxy/config.conf ->
             ├─kubepods-besteffort-pod0d08528f_4fe7_413c_9501_fc82cbee4036.slice:cri-conta>
             │ └─2780 /pause
             ├─kubepods-burstable-pod0ab3cefe_c9e4_49a3_b60b_7c857dbf3ec9.slice:cri-contai>
             │ └─3403 /opt/bin/flanneld --ip-masq --kube-subnet-mgr --iface=eth0
             └─kubepods-burstable-pod0ab3cefe_c9e4_49a3_b60b_7c857dbf3ec9.slice:cri-contai>
               └─2772 /pause

May 20 10:39:37 node01 containerd[1174]: time="2024-05-20T10:39:37.766352739Z" level=info >
May 20 10:39:38 node01 containerd[1174]: time="2024-05-20T10:39:38.009374633Z" level=info >
May 20 10:39:38 node01 containerd[1174]: time="2024-05-20T10:39:38.225976092Z" level=info >
May 20 10:39:38 node01 containerd[1174]: time="2024-05-20T10:39:38.226026032Z" level=warni>
May 20 10:39:38 node01 containerd[1174]: time="2024-05-20T10:39:38.226034433Z" level=info >
May 20 10:39:38 node01 containerd[1174]: time="2024-05-20T10:39:38.237606483Z" level=warni>
May 20 10:39:38 node01 containerd[1174]: time="2024-05-20T10:39:38.731892708Z" level=info >
May 20 10:39:38 node01 containerd[1174]: time="2024-05-20T10:39:38.770657623Z" level=info >
May 20 10:39:38 node01 containerd[1174]: time="2024-05-20T10:39:38.771234183Z" level=info >
May 20 10:39:39 node01 containerd[1174]: time="2024-05-20T10:39:39.026087981Z" level=info >


node01 ~ ✖ systemctl status kubelet
○ kubelet.service - kubelet: The Kubernetes Node Agent
     Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)
    Drop-In: /usr/lib/systemd/system/kubelet.service.d
             └─10-kubeadm.conf
     Active: inactive (dead) since Mon 2024-05-20 10:44:53 UTC; 3min 30s ago
       Docs: https://kubernetes.io/docs/
    Process: 2570 ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS>
   Main PID: 2570 (code=exited, status=0/SUCCESS)

May 20 10:39:33 node01 kubelet[2570]: I0520 10:39:33.652026    2570 reconciler_common.go:2>
May 20 10:39:33 node01 kubelet[2570]: I0520 10:39:33.652049    2570 reconciler_common.go:2>
May 20 10:39:34 node01 kubelet[2570]: I0520 10:39:34.669662    2570 kuberuntime_container_>
May 20 10:39:34 node01 kubelet[2570]: I0520 10:39:34.709771    2570 kuberuntime_container_>
May 20 10:39:35 node01 kubelet[2570]: I0520 10:39:35.935499    2570 pod_startup_latency_tr>
May 20 10:39:37 node01 kubelet[2570]: I0520 10:39:37.727337    2570 kuberuntime_container_>
May 20 10:39:38 node01 kubelet[2570]: I0520 10:39:38.069034    2570 kubelet_node_status.go>
May 20 10:39:38 node01 kubelet[2570]: I0520 10:39:38.730906    2570 kuberuntime_container_>
May 20 10:39:39 node01 kubelet[2570]: I0520 10:39:39.742700    2570 pod_startup_latency_tr>
May 20 10:44:53 node01 kubelet[2570]: I0520 10:44:53.270636    2570 dynamic_cafile_content>


node01 ~ ✖ systemctl start kubelet

node01 ~ ➜  systemctl status kubelet
● kubelet.service - kubelet: The Kubernetes Node Agent
     Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)
    Drop-In: /usr/lib/systemd/system/kubelet.service.d
             └─10-kubeadm.conf
     Active: active (running) since Mon 2024-05-20 10:48:47 UTC; 4s ago
       Docs: https://kubernetes.io/docs/
   Main PID: 6635 (kubelet)
      Tasks: 25 (limit: 251379)
     Memory: 37.2M
     CGroup: /system.slice/kubelet.service
             └─6635 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kube>

May 20 10:48:48 node01 kubelet[6635]: I0520 10:48:48.870245    6635 apiserver.go:52] "Watc>
May 20 10:48:48 node01 kubelet[6635]: I0520 10:48:48.872532    6635 topology_manager.go:21>
May 20 10:48:48 node01 kubelet[6635]: I0520 10:48:48.872624    6635 topology_manager.go:21>
May 20 10:48:48 node01 kubelet[6635]: I0520 10:48:48.903435    6635 desired_state_of_world>
May 20 10:48:48 node01 kubelet[6635]: I0520 10:48:48.917604    6635 reconciler_common.go:2>
May 20 10:48:48 node01 kubelet[6635]: I0520 10:48:48.917720    6635 reconciler_common.go:2>
May 20 10:48:48 node01 kubelet[6635]: I0520 10:48:48.917753    6635 reconciler_common.go:2>
May 20 10:48:48 node01 kubelet[6635]: I0520 10:48:48.917825    6635 reconciler_common.go:2>
May 20 10:48:48 node01 kubelet[6635]: I0520 10:48:48.917872    6635 reconciler_common.go:2>
May 20 10:48:48 node01 kubelet[6635]: I0520 10:48:48.918109    6635 reconciler_common.go:2>


node01 ~ ✖ exit
logout
Connection to node01 closed.

controlplane ~ ✖ k get nodes
NAME           STATUS   ROLES           AGE     VERSION
controlplane   Ready    control-plane   10m     v1.29.0
node01         Ready    <none>          9m44s   v1.29.0

controlplane ~ ➜



```
